# 🎱 쿠버네티스 기반 GitOps 구축하기
도커 시작하기

---
# 도커의 이해
1. Application 구성 요소 배포의 어려움
2. 설치 방식의 가지 수 증가로 인한 복잡성

이때 도커를 사용하면 규격화된 컨테이너로 어떤 운영 체제에서도 동일한 동작을 보장한다.   
도커와 자주 비교되는 것이 Virtual Machine (가상 머신)이다.

1. Virtual Machine
   - 가상 머신에는 애플리케이션, 필수 라이브러리 또는 바이너리 및 전체 게스트 운영 체제가 포함되어 전체 가상화를 위해서는 컨테이너화보다 더 많은 리소스가 필요함
2. Docker 컨테이너
   - 컨테이너에는 애플리케이션과 모든 종속성이 포함되나 컨테이너는 호스트 운영 체제의 사용자 공간에 있는 격리 프로세스로 실행 중인 다른 컨테이너와 OS 커널을 공유함

### 도커 아키텍처
1. Client: Docker API와 상호 작용
   - Docker run
   - Docker build
   - Docker pull
2. Docker Host
   - Docker Daemon: Docker API 요청을 수신하고 이미지, 컨테이너, 네트워크 및 볼과 같은 Docker 개체 관리
   - Image: 컨테이너를 만들기 위한 지침이 포함된 읽기 전용 템플릿
   - Containers: 실행 가능한 인스턴스. 생성, 시작, 중지, 이동, 삭제 가능
3. Registry: Docker 이미지 저장소
   - Image, Extensions, Plugins

# 도커의 구성 요소 및 기능
## Docker Image
Docker 이미지 레이어: Docker 이미지를 구성하는 다중 계층 구조

1. 계층화된 저장
    - 각 레이어는 변경된 부분만 저장함
    - 예) 한 레이어에서 파일을 추가하고 다음 레이어에서 해당 파일을 수정하면, 두 번째 레이어는 수정된 부분만을 포함함
2. 재사용과 공유
    - 공통 레이어는 여러 이미지들 간에 재사용 될 수 있음
    - 예) 여러 이미지가 동일한 기반 이미지(ex. ubuntu)를 사용한다면, 이 기반 이미지 레이어는 한 번만 저장되고 모든 이미지에서 공유됨
3. 효율적인 스토리지 관리
    - 레이어를 사용함으로써, 이미지의 각 버전을 별도로 저장할 필요 없이 변경된 부분만 저장함으로써 스토리지를 효율적으로 사용할 수 있음
4. 빠른 배포 및 확장성
    - 이미 캐시된 레이어는 다시 다운로드하거나 재구축할 필요가 없기 때문에, 이미지의 배포와 확장이 빠름

## Docker run Details
- Docker를 실행시킨다는 것은 이제까지 Docker Image가 가지고 있던 레이러를 Base로 하여 새로이 레이어를 추가하면서 호스트 시스템과 커널을 공유하는 새로운 프로세스를 실행하는 것을 의미

## Docker Networking
- Docker 네트워킹은 도커 컨테이너를 서로 연결하고 외부 세계와 연결하여 서로 통신할 수 있고 Docker Host와 통신할 수 있도록 하는 것
- Docker는 네트워킹을 통해 CNM(Container Network Model)을 사용함

### Docker Bridge Networking
1. 기본 네트워크
   - Docker에 컨테이너를 배포할 때 기본적으로 생성되는 네트워크
2. 소프트웨어 브리지
   - 컨테이너 간 통신을 가능하게 하는 중간 매개체 역할
3. 내부 통신 지원
   - 같은 브리지 네트워크에 속한 컨테이너들끼리 통신 가능
4. 호스트 격리
   - 컨테이너들은 동일한 Docker daemon 호스트 내에서 실행되며, 호스트 시스템으로부터 격리된 상태를 유지 
5. 네트워크 격리
    - 컨테이너들이 호스트의 다른 네트워크 요소로부터 격리되는 비공개 내부 네트워크를 생성
6. 효율적인 리소스 관리
    - 리소스 분리와 효율적인 관리를 위해 설계됨

### Docker Host Networking
1. 호스트 시스템과의 직접 연결
   - 컨테이너가 호스트 시스템의 네트워크 인터페이스를 직접 사용
2. 포트 매핑 불필요
    - 컨테이너와 호스트가 같은 IP 주소를 공유하기 때문에 별도의 포트 매핑이 필요 없음
3. 성능 최적화
    - 네트워크 오버헤드 감소로 인해 성능이 최적화
4. 간소화된 네트워킹
    - 네트워크 구성이 간소화되어 관리가 용이
5. 보안 고려사항
    - 호스트 네트워크를 사용할 때는 컨테이너와 호스트 시스템 간의 보안 경계가 약해질 수 있으므로 주의가 필요
6. 적합한 사용 사례
   - 높은 네트워크 성능이 필요하거나 단순 네트워크 구성이 요구되는 경우에 적합

### Docker Overlay Networking
1. 다중 호스트 네트워킹
   - 다수의 Docker 호스트 간의 컨테이너를 연결
2. 가상 네트워크 레이어
   - 실제 네트워크 위에 가상의 네트워크 레이러르 구축하여 컨테이너 간 통신을 가능하게 함
3. 스케일 가능성
   - 대규모 클러스터 환경에서 컨테이너 네트워킹을 확장하는 데 적합
4. 네트워크 격리
   - 컨테이너들은 격리된 네트워크 환경에서 안전하게 통신
5. IP 관리
   - 자동 IP 할당 및 관리를 통해 네트워크 관리를 간소화
6. 서비스 검색
    - 내장된 서비스 검색 기능으로 컨테이너 간의 상호 발견 및 통신이 용이
7. 보안성
    - 데이터 전송 시 암호화를 제공하여 네트워크 보안을 강화

## 도커 볼륨
- 컨테이너(이미지의 인스턴스)를 생성할 때 Docker는 이미지 레이어를 가져와 그 위에 thin(읽기-쓰기) 레이어를 추가함
- 이 레이어는 컨테이너가 실행 중일 때만 존재하며 컨테이너가 실행 중인 상태에서 생성되는 모든 데이터는 이 레이어에 저장됨
- Docker 볼륨을 사용하면 이 레이어에 있는 데이터를 지속할 수 있음

### 도커 볼륨 타입
1. Docker Volume
    - 도커가 관리하는 볼륨으로, 컨테이너와 호스트 시스템 사이에 영구적인 데이터를 저장함
    - 도커 엔진에 의해 자동으로 생성되며, 데이터의 백업 및 마이그레이션에 적합
    - 호스트 파일 시스템의 구체적인 위치를 신경 쓸 필요가 없음
2. Docker Bind Mount
    - 호스트 시스템의 특정 파일이나 디렉토리를 컨테이너에 마운트함
    - 개발 과정에서 소스 코드 같은 데이터를 컨테이너에 실시간으로 반영하는 데 유용
    - 호스트 시스템의 파일 시스템 경로를 명시적으로 지정해야 함
3. tmpfs Mounts
   - 호스트의 메모리에 데이터를 저장하는 마운트 유형
   - 컨테이너가 종료되면 저장된 데이터는 사라짐
   - 민감한 정보를 임시로 저장하거나, 디스크 I/O를 줄이고 싶을 때 유용

## Docker compose를 활용한 마이크로서비스 배포 실습
- docker-compose.yml 파일을 사용하여 애플리케이션의 서비스, 네트워크, 볼륨 등을 구성하며, 이 파일을 통해 여러 컨테이너와 그 관계를 쉽게 정의하고 관리할 수 있음
- docker-compose를 사용하면 단일 명령어로 여러 컨테이너 기반의 애플리케이션을 구축하고 시작할 수 있어, 복잡한 멀티-컨테이너 환경을 효율적으로 관리할 수 있음